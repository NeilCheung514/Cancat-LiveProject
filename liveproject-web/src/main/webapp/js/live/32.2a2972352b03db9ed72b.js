(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{1297:function(t,n,e){"use strict";e.r(n);var i=e(1),s=e.n(i),a=e(19),r=e.n(a),o=e(1516),l=e.n(o);e(1513);var u=e(61),c=e(16);var p={isGiftSlot:function(t,n){return parseInt(t,0).toString()===t.toString()&&n>=4},getGiftImage:function(t){return Object(c.bfsImgLink)(Object(u.d)(parseInt(t,0)),60,60,{useWebp:!0})}};var h=e(15),m=e.n(h),d=e(20);e.d(n,"DanmakuAnnouncementController",function(){return g});var f=Object(d.c)("danmaku-announcement/core"),g=function(){function t(n){var e=this;s()(this,t),this.initialized=!1,this.parentDom=null,this.positionCtnr=null,this.wrapperDom=null,this.announcementQueue=[],this.animationEndName="",this.animationTimeout=null,this.isShowingAnnouncement=!1,this.startCallback=null,this.endCallback=null,n&&this.init(n),m.a.$on("livePlayer:operableElementChange",function(){e.isShowingAnnouncement&&e.animationEnd()})}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.prepareAnnouncementDom=function(){f(this.parentDom.getBoundingClientRect(),this.startCallback,this.endCallback),this.wrapperDom||(this.wrapperDom=document.createElement("div"),this.wrapperDom.style.position="absolute",this.wrapperDom.style.top="0",this.wrapperDom.style.willChange="left",this.wrapperDom.style.transform="translateZ(0)",this.wrapperDom.style.whiteSpace="nowrap",this.wrapperDom.style.fontSize="0",this.wrapperDom.style.display="inline-block",this.wrapperDom.style.zIndex="2",this.wrapperDom.addEventListener(this.animationEndName,this.animationEnd.bind(this))),this.positionCtnr.appendChild(this.wrapperDom)},t.prototype.animationEnd=function(){clearTimeout(this.animationTimeout),this.wrapperDom.style.transition="",this.announcementQueue.splice(0,1),this.announcementQueue.length?(this.setAnnouncementDom(),setTimeout(this.startAnnouncementAnimation.bind(this),100)):(this.positionCtnr.removeChild(this.wrapperDom),this.isShowingAnnouncement=!1,this.endCallback&&this.endCallback())},t.prototype.setAnnouncementDom=function(){var t;this.wrapperDom.innerHTML=(t=function(t){var n=t.message?t.message.split(":?"):[];switch(t.type){case"system":return{styleId:parseInt(t.subType,0),message:n,url:t.url||null};case"gift":return{styleId:3,message:n,url:t.url||null,giftId:parseInt(t.subType)};case"guard":return{styleId:parseInt(t.subType,0)+4,message:n,url:t.url||null};default:return{styleId:0,message:n,url:t.url||null}}}(this.announcementQueue[0]),l()(r()({},p,t))),f(this.wrapperDom,this.wrapperDom.scrollWidth),this.wrapperDom.style.left="100%"},t.prototype.startAnnouncementAnimation=function(){var t=this,n=Date.now()-this.announcementQueue[0].createAt,e="system"===this.announcementQueue[0].type&&2===this.announcementQueue[0].subType;if(n>3e5&&e)return this.animationEnd();var i=(this.positionCtnr.clientWidth+this.wrapperDom.clientWidth+10)/(this.announcementQueue.length<5?90:120);f(i,this.positionCtnr.clientWidth,this.wrapperDom.clientWidth),this.animationTimeout=setTimeout(function(){return t.animationEnd()},1e3*i+1e4),this.wrapperDom.style.transition="left "+i+"s linear",this.wrapperDom.style.left="-"+this.wrapperDom.scrollWidth+"px"},t.prototype.displayAnnouncement=function(){this.initialized&&!this.isShowingAnnouncement&&(this.isShowingAnnouncement=!0,this.startCallback&&this.startCallback(),this.prepareAnnouncementDom(),this.setAnnouncementDom(),setTimeout(this.startAnnouncementAnimation.bind(this),100))},t.prototype.init=function(t){if(!this.initialized){var n,e,i=t.parentElement,s=t.onAnnouncementElementShow,a=t.onAnnouncementElementHide;this.setStartCallback(s),this.setEndCallback(a),this.animationEndName=(n=document.createElement("div").style,e=["transition","OTransition","MozTransition","WebkitTransition"],{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",MozTransition:"transitionend"}[function(){for(var t=0,i=e.length,s=void 0;t<i;t++)if(void 0!==n[s=e[t]])return s;return!1}()]),i&&this.bindDom(i)}},t.prototype.bindDom=function(t){this.positionCtnr||(this.positionCtnr=document.createElement("div"),this.positionCtnr.style.position="absolute",this.positionCtnr.style.top="0",this.positionCtnr.style.left="0",this.positionCtnr.style.width="100%",this.positionCtnr.style.overflow="hidden",this.positionCtnr.style.height="100px"),this.parentDom?(this.parentDom.removeChild(this.positionCtnr),this.parentDom=t,this.parentDom.appendChild(this.positionCtnr)):(this.parentDom=t,this.parentDom.appendChild(this.positionCtnr),this.initialized=!0),this.announcementQueue.length&&this.displayAnnouncement()},t.prototype.showAnnouncement=function(t){t.createAt=Date.now(),f(t),this.announcementQueue.push(t),this.displayAnnouncement()},t.prototype.setStartCallback=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.startCallback=t},t.prototype.setEndCallback=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.endCallback=t},t}();g.instance=null},1513:function(t,n,e){},1514:function(t,n){},1515:function(t,n,e){"use strict";var i=Object.prototype.hasOwnProperty;function s(t,n){return Array.isArray(t)?function(t,n){for(var e,i="",a="",r=Array.isArray(n),o=0;o<t.length;o++)(e=s(t[o]))&&(r&&n[o]&&(e=l(e)),i=i+a+e,a=" ");return i}(t,n):t&&"object"==typeof t?function(t){var n="",e="";for(var s in t)s&&t[s]&&i.call(t,s)&&(n=n+e+s,e=" ");return n}(t):t||""}function a(t){if(!t)return"";if("object"==typeof t){var n="";for(var e in t)i.call(t,e)&&(n=n+e+":"+t[e]+";");return n}return t+""}function r(t,n,e,i){return!1!==n&&null!=n&&(n||"class"!==t&&"style"!==t)?!0===n?" "+(i?t:t+'="'+t+'"'):("function"==typeof n.toJSON&&(n=n.toJSON()),"string"==typeof n||(n=JSON.stringify(n),e||-1===n.indexOf('"'))?(e&&(n=l(n))," "+t+'="'+n+'"'):" "+t+"='"+n.replace(/'/g,"&#39;")+"'"):""}n.merge=function t(n,e){if(1===arguments.length){for(var i=n[0],s=1;s<n.length;s++)i=t(i,n[s]);return i}for(var r in e)if("class"===r){var o=n[r]||[];n[r]=(Array.isArray(o)?o:[o]).concat(e[r]||[])}else if("style"===r){var o=a(n[r]);o=o&&";"!==o[o.length-1]?o+";":o;var l=a(e[r]);l=l&&";"!==l[l.length-1]?l+";":l,n[r]=o+l}else n[r]=e[r];return n},n.classes=s,n.style=a,n.attr=r,n.attrs=function(t,n){var e="";for(var o in t)if(i.call(t,o)){var l=t[o];if("class"===o){l=s(l),e=r(o,l,!1,n)+e;continue}"style"===o&&(l=a(l)),e+=r(o,l,!1,n)}return e};var o=/["&<>]/;function l(t){var n=""+t,e=o.exec(n);if(!e)return t;var i,s,a,r="";for(i=e.index,s=0;i<n.length;i++){switch(n.charCodeAt(i)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}s!==i&&(r+=n.substring(s,i)),s=i+1,r+=a}return s!==i?r+n.substring(s,i):r}n.escape=l,n.rethrow=function t(n,i,s,a){if(!(n instanceof Error))throw n;if(!("undefined"==typeof window&&i||a))throw n.message+=" on line "+s,n;try{a=a||e(1514).readFileSync(i,"utf8")}catch(e){t(n,null,s)}var r=3,o=a.split("\n"),l=Math.max(s-r,0),u=Math.min(o.length,s+r);var r=o.slice(l,u).map(function(t,n){var e=n+l+1;return(e==s?"  > ":"    ")+e+"| "+t}).join("\n");n.path=i;n.message=(i||"Pug")+":"+s+"\n"+r+"\n\n"+n.message;throw n}},1516:function(t,n,e){var i=e(1515);t.exports=function(t){var n,e="",s=t||{};return function(t,s,a,r){e=e+"<div"+i.attr("class",i.classes(["announcement-wrapper","clearfix","no-select","style-id-"+a],[!1,!1,!1,!0]),!1,!0)+"><div"+i.attr("class",i.classes(["gift-prefix","v-bottom","gift-"+a],[!1,!1,!0]),!1,!0)+"></div>",r?(e=e+"<a"+i.attr("href",r,!0,!0)+' target="_blank"><div'+i.attr("class",i.classes(["gift-content","v-bottom","content-"+a],[!1,!1,!0]),!1,!0)+">",function(){var a=s;if("number"==typeof a.length)for(var r=0,o=a.length;r<o;r++){var l=a[r];t(l,r)?e+='<span class="v-middle gift-image" style="background-image:url(#{getGiftImage(val)})"></span>':e=e+"<span"+i.attr("class",i.classes(["v-middle",{highlight:r%2==s.length%2}],[!1,!0]),!1,!0)+">"+i.escape(null==(n=" "+l)?"":n)+"</span>"}else for(var r in o=0,a)o++,l=a[r],t(l,r)?e+='<span class="v-middle gift-image" style="background-image:url(#{getGiftImage(val)})"></span>':e=e+"<span"+i.attr("class",i.classes(["v-middle",{highlight:r%2==s.length%2}],[!1,!0]),!1,!0)+">"+i.escape(null==(n=" "+l)?"":n)+"</span>"}.call(this),e+='<div class="gift-finger"></div></div></a>'):(e=e+"<div"+i.attr("class",i.classes(["gift-content","v-bottom","content-"+a],[!1,!1,!0]),!1,!0)+">",function(){var a=s;if("number"==typeof a.length)for(var r=0,o=a.length;r<o;r++){var l=a[r];t(l,r)?e+='<span class="v-middle gift-image" style="background-image:url(#{getGiftImage(val)})"></span>':e=e+"<span"+i.attr("class",i.classes(["v-middle",{highlight:r%2==s.length%2}],[!1,!0]),!1,!0)+">"+i.escape(null==(n=l)?"":n)+"</span>"}else for(var r in o=0,a)o++,l=a[r],t(l,r)?e+='<span class="v-middle gift-image" style="background-image:url(#{getGiftImage(val)})"></span>':e=e+"<span"+i.attr("class",i.classes(["v-middle",{highlight:r%2==s.length%2}],[!1,!0]),!1,!0)+">"+i.escape(null==(n=l)?"":n)+"</span>"}.call(this),e+="</div>"),e+="</div>"}.call(this,"isGiftSlot"in s?s.isGiftSlot:"undefined"!=typeof isGiftSlot?isGiftSlot:void 0,"message"in s?s.message:"undefined"!=typeof message?message:void 0,"styleId"in s?s.styleId:"undefined"!=typeof styleId?styleId:void 0,"url"in s?s.url:"undefined"!=typeof url?url:void 0),e}}}]);